<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Leaderboard</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="config.js"></script>
</head>
<body class="bg-white p-4">
  <h1 class="text-2xl font-bold mb-4">Leaderboard</h1>
  <table class="table-auto border-collapse w-full text-center text-sm">
    <thead>
      <tr>
        <th class="border p-2">Player</th>
        <th class="border p-2">Rounds</th>
        <th class="border p-2">Avg Score</th>
        <th class="border p-2">Avg ToPar</th>
        <th class="border p-2">Best Score</th>
      </tr>
    </thead>
    <tbody id="board"></tbody>
  </table>

  <script>
    // Load all players from localStorage
    const historicalPlayers = JSON.parse(localStorage.getItem("players")) || [];

    fetch(APPS_SCRIPT_URL)
      .then(res => res.json())
      .then(data => {
        const players = {};

        // Initialize all players, even if they don't have rounds yet
        historicalPlayers.forEach(p => {
          players[p] = { rounds: 0, total: 0, totalToPar: 0, best: Infinity };
        });

        // Process existing rounds from the sheet
        data.forEach(r => {
          const p = r.Player;
          if(!players[p]) players[p] = { rounds: 0, total: 0, totalToPar: 0, best: Infinity };
          players[p].rounds++;
          players[p].total += Number(r.Total) || 0;
          players[p].totalToPar += Number(r.ToPar) || 0;
          players[p].best = Math.min(players[p].best, Number(r.Total) || Infinity);
        });

        // Build leaderboard HTML
        const rows = Object.entries(players).map(([name, stats]) => {
          const avg = stats.rounds ? (stats.total / stats.rounds).toFixed(1) : "-";
          const avgToPar = stats.rounds ? (stats.totalToPar / stats.rounds).toFixed(1) : "-";
          const best = stats.best !== Infinity ? stats.best : "-";
          return `<tr>
            <td class="border p-2 font-semibold">${name}</td>
            <td class="border p-2">${stats.rounds}</td>
            <td class="border p-2">${avg}</td>
            <td class="border p-2">${avgToPar}</td>
            <td class="border p-2">${best}</td>
          </tr>`;
        }).join("");

        document.getElementById("board").innerHTML = rows;
      });
  </script>
</body>
</html>
