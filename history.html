<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Round History</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="config.js"></script>
</head>
<body class="bg-gray-50 min-h-screen flex flex-col items-center p-6">

  <h1 class="text-3xl font-bold text-gray-800 mb-6">Round History</h1>

  <div id="history" class="w-full max-w-4xl space-y-6"></div>

  <script>
    fetch(APPS_SCRIPT_URL)
      .then(res => res.json())
      .then(data => {
        const grouped = {};
        data.forEach(r => {
          const key = `${r.Date} | ${r.Course}`;
          if(!grouped[key]) grouped[key] = [];
          grouped[key].push(r);
        });

        const sortedKeys = Object.keys(grouped).sort((a,b) => new Date(b.split(" | ")[0]) - new Date(a.split(" | ")[0]));

        const html = sortedKeys.map(key => {
          const rounds = grouped[key];
          const tableRows = rounds.map(r => {
            const holeScores = [];
            for(let i=1; i<=18; i++){
              if(r[`Score${i}`] !== undefined && r[`Score${i}`] !== "") {
                holeScores.push(`${r[`Score${i}`]} (${r[`Par${i}`] || "-"})`);
              }
            }
            return `<tr class="hover:bg-gray-50 transition-colors">
              <td class="border p-2 font-semibold">${r.Player}</td>
              <td class="border p-2">${r.Total}</td>
              <td class="border p-2">${r.ToPar >= 0 ? "+"+r.ToPar : r.ToPar}</td>
              <td class="border p-2">${holeScores.join(" | ")}</td>
            </tr>`;
          }).join("");

          return `<div class="overflow-x-auto bg-white p-4 rounded-2xl shadow-lg">
            <p class="font-bold mb-2 text-gray-700">${key}</p>
            <table class="table-auto border-collapse w-full text-center text-sm min-w-max">
              <thead>
                <tr class="bg-gray-100 text-gray-700 font-semibold">
                  <th class="border p-2">Player</th>
                  <th class="border p-2">Total</th>
                  <th class="border p-2">To Par</th>
                  <th class="border p-2">Hole-by-Hole</th>
                </tr>
              </thead>
              <tbody>${tableRows}</tbody>
            </table>
          </div>`;
        }).join("");

        document.getElementById("history").innerHTML = html;
      });
  </script>

</body>
</html>
