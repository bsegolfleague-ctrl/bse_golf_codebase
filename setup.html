
<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Setup Round – BSE Golf</title>
  <link rel="stylesheet" href="./style.css">
</head>
<body>
  <div class="container">
    <div class="card">
      <h1>Setup Round</h1>
      <div class="row">
        <input id="course" class="input" placeholder="Course name (required)" />
        <input id="date" class="input" type="date" />
        <input id="holes" class="input" type="number" min="1" max="36" placeholder="Number of holes (e.g., 18)" />
      </div>

      <h2>Players</h2>
      <div id="players" class="row"></div>
      <div class="row" style="margin-top:8px;">
        <input id="newPlayer" class="input" placeholder="Add new player name" />
        <button id="addPlayerBtn" class="btn">Add Player</button>
      </div>

      <div class="row" style="margin-top:16px;">
        <button id="startBtn" class="btn">Start Round</button>
        <span id="status" class="helper"></span>
      </div>

      <div class="nav">
        <a href="./index.html">Home</a>
        <a href="./submit.html">Go to Submit</a>
      </div>
    </div>
  </div>

  <script type="module">
    import { getPlayers, addPlayer } from './config.js';
    const playersWrap = document.getElementById('players');
    const status = document.getElementById('status');

    function chip(name){
      const id = `p_${name.replace(/\s+/g,'_')}`;
      return \`
        <label class="badge" style="cursor:pointer;">
          <input type="checkbox" id="\${id}" value="\${name}" style="margin-right:6px;"> \${name}
        </label>
      \`;
    }

    async function loadPlayers(){
      playersWrap.innerHTML = '<span class="helper">Loading players…</span>';
      try{
        const list = await getPlayers();
        playersWrap.innerHTML = list.map(p => chip(p.name)).join('');
      }catch(e){
        console.error(e);
        playersWrap.innerHTML = '<span style="color:#b91c1c">Failed to load players</span>';
      }
    }

    document.getElementById('addPlayerBtn').addEventListener('click', async () => {
      const name = document.getElementById('newPlayer').value.trim();
      if(!name){ status.textContent = 'Enter a player name'; return; }
      try{
        await addPlayer(name);
        document.getElementById('newPlayer').value='';
        await loadPlayers();
        status.textContent = 'Player added';
      }catch(e){
        status.textContent = 'Failed to add player';
        console.error(e);
      }
    });

    document.getElementById('startBtn').addEventListener('click', () => {
      const course = document.getElementById('course').value.trim();
      const date = document.getElementById('date').value; // yyyy-mm-dd
      const holes = parseInt(document.getElementById('holes').value,10);
      const selected = [...document.querySelectorAll('#players input[type=checkbox]:checked')].map(i => i.value);

      if(!course){ status.textContent = 'Course is required'; return; }
      if(!(holes > 0)){ status.textContent = 'Enter number of holes'; return; }
      if(selected.length === 0){ status.textContent = 'Select at least one player'; return; }

      const payload = { course, date, holes, players: selected }; // keep order selected
      localStorage.setItem('roundSetup', JSON.stringify(payload));
      status.textContent = 'Saved. Open Submit Round.';
    });

    loadPlayers();
  </script>
</body>
</html>
