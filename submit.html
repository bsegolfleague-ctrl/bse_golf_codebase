<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Submit Score – Indoor Golf League</title>
<script src="https://cdn.tailwindcss.com"></script>
<script defer src="config.js"></script>
</head>
<body class="bg-gray-100 min-h-screen">
<header class="p-4 bg-white shadow sticky top-0 z-10">
<div class="max-w-xl mx-auto flex items-center gap-3">
<a href="index.html" class="text-blue-600">← Home</a>
<h1 class="text-xl font-bold">Submit Score</h1>
</div>
</header>


<main class="p-4 max-w-xl mx-auto">
<form id="scoreForm" class="bg-white rounded-2xl p-4 shadow space-y-4">
<input name="Player" placeholder="Player" class="w-full border rounded-xl p-3" required />
<input name="Course" placeholder="Course" class="w-full border rounded-xl p-3" required />
<input name="Score" type="number" min="1" placeholder="Score" class="w-full border rounded-xl p-3" required />
<input name="Date" type="date" class="w-full border rounded-xl p-3" required />
<input name="Handicap" type="number" step="0.1" placeholder="Handicap (optional)" class="w-full border rounded-xl p-3" />
<input name="Notes" placeholder="Notes (optional)" class="w-full border rounded-xl p-3" />
<button id="submitBtn" class="w-full bg-green-600 text-white py-3 rounded-xl">Submit</button>
<p id="msg" class="text-center text-sm text-gray-600"></p>
</form>
</main>


<script>
// Default date to today
const today = new Date().toISOString().slice(0,10);
document.addEventListener('DOMContentLoaded', () => {
const dateInput = document.querySelector('input[name="Date"]');
if (dateInput && !dateInput.value) dateInput.value = today;
});


document.getElementById('scoreForm').addEventListener('submit', async (e) => {
e.preventDefault();
const btn = document.getElementById('submitBtn');
const msg = document.getElementById('msg');
msg.textContent = '';


if (!window.CONFIG || !CONFIG.APPS_SCRIPT_URL) {
msg.textContent = 'Missing config.js URL';
return;
}


btn.disabled = true; btn.textContent = 'Submitting…';


const formData = new FormData(e.target);
try {
// Use URLSearchParams to keep this a simple POST (avoids CORS preflight)
const payload = new URLSearchParams(formData);
const res = await fetch(CONFIG.APPS_SCRIPT_URL, { method: 'POST', body: payload });
if (!res.ok) throw new Error('Network error');
const json = await res.json().catch(() => ({ ok: true }));
if (json.ok) {
msg.textContent = '✅ Score submitted!';
e.target.reset();
// Reset date to today after clearing form
const dateInput = document.querySelector('input[name="Date"]');
if (dateInput && !dateInput.value) dateInput.value = today;
} else {
msg.textContent = 'Something went wrong. Check your Sheet headers.';
}
} catch (err) {
console.error(err);
msg.textContent = 'Error submitting score. Check your Web App URL & permissions.';
} finally {
btn.disabled = false; btn.textContent = 'Submit';
}
});
</script>
</body>
</html>
